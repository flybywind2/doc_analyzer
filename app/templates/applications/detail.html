{% extends "base.html" %}

{% block title %}ì§€ì›ì„œ ìƒì„¸{% endblock %}

{% block content %}
<div class="page-header">
    <h2>ì§€ì›ì„œ ìƒì„¸</h2>
    <div class="actions">
        <button onclick="history.back()" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</button>
        {% if user.role == 'admin' %}
        <button onclick="deleteApplication()" class="btn btn-danger">ì‚­ì œ</button>
        {% endif %}
    </div>
</div>

<div id="application-detail" class="detail-container">
    <!-- ë¡œë”© ì¤‘ -->
    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<script>
const applicationId = {{ application_id }};
let currentApplication = null;
let allEvaluations = [];
let currentUserEvaluation = null;

// ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë¡œë“œ
async function loadApplicationDetail() {
    const container = document.getElementById('application-detail');
    
    try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(`/api/applications/${applicationId}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to load application');
        }
        
        const app = await response.json();
        currentApplication = app; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        
        // AI ì¹´í…Œê³ ë¦¬ íŒŒì‹±
        let aiCategories = [];
        if (app.ai_categories) {
            try {
                aiCategories = typeof app.ai_categories === 'string' 
                    ? JSON.parse(app.ai_categories) 
                    : app.ai_categories;
            } catch (e) {
                console.error('AI categories parsing error:', e);
            }
        }
        
        // AI í‰ê°€ ìƒì„¸ íŒŒì‹±
        let aiEvaluationDetail = {};
        if (app.ai_evaluation_detail) {
            try {
                aiEvaluationDetail = typeof app.ai_evaluation_detail === 'string'
                    ? JSON.parse(app.ai_evaluation_detail)
                    : app.ai_evaluation_detail;
            } catch (e) {
                console.error('AI evaluation detail parsing error:', e);
            }
        }
        
        // ê¸°ìˆ  ì—­ëŸ‰ íŒŒì‹±
        let techCapabilities = {};
        if (app.tech_capabilities) {
            try {
                techCapabilities = typeof app.tech_capabilities === 'string'
                    ? JSON.parse(app.tech_capabilities)
                    : app.tech_capabilities;
            } catch (e) {
                console.error('Tech capabilities parsing error:', e);
            }
        }
        
        container.innerHTML = `
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="card">
                <h3>ê¸°ë³¸ ì •ë³´</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>ê³¼ì œëª…</label>
                        <div>${app.subject || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <label>ì‚¬ì—…ë¶€</label>
                        <div>${app.division || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <label>ë¶€ì„œ</label>
                        <div>${app.department_name || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <label>ì°¸ì—¬ ì¸ì›</label>
                        <div>${app.participant_count || '-'}ëª…</div>
                    </div>
                    <div class="detail-item">
                        <label>ëŒ€í‘œì</label>
                        <div>${app.representative_name || '-'} (${app.representative_knox_id || '-'})</div>
                    </div>
                    <div class="detail-item">
                        <label>ìƒíƒœ</label>
                        <div><span class="badge badge-${app.status}">${getStatusText(app.status)}</span></div>
                    </div>
                </div>
            </div>
            
            <!-- AI í‰ê°€ ê²°ê³¼ -->
            <div class="card">
                <h3>AI í‰ê°€ ê²°ê³¼</h3>
                
                ${app.ai_grade ? `
                    <!-- AI ê¸°ìˆ  ë¶„ë¥˜ -->
                    <div class="ai-section">
                        <h4><i class="icon">ğŸ¤–</i> 1. AI ê¸°ìˆ  ë¶„ë¥˜</h4>
                        <div class="ai-tech-classification">
                            <div class="tech-badge-large">
                                <span class="badge badge-tech">${aiEvaluationDetail.ai_technology?.category || app.ai_category_primary || 'Unknown'}</span>
                                ${aiEvaluationDetail.ai_technology?.confidence ? 
                                    `<small>(í™•ì‹ ë„: ${Math.round(aiEvaluationDetail.ai_technology.confidence * 100)}%)</small>` : ''}
                            </div>
                            ${aiEvaluationDetail.ai_technology?.reason ? 
                                `<p class="reason-text">${aiEvaluationDetail.ai_technology.reason}</p>` : ''}
                        </div>
                    </div>
                    
                    <!-- Biz Impact -->
                    <div class="ai-section">
                        <h4><i class="icon">ğŸ’¼</i> 2. Biz Impact (ì‚¬ì—… ì˜í–¥ë„)</h4>
                        <div class="impact-score">
                            <div class="score-display">
                                <span class="score-number">${aiEvaluationDetail.biz_impact?.score?.toFixed(1) || 'N/A'}</span>
                                <span class="score-max">/ 5.0</span>
                                <span class="badge badge-grade-${aiEvaluationDetail.scores?.['Biz Impact']?.grade || 'B'}">
                                    ${aiEvaluationDetail.scores?.['Biz Impact']?.grade || '-'}
                                </span>
                            </div>
                        </div>
                        ${aiEvaluationDetail.biz_impact?.summary ? 
                            `<p class="summary-text">${aiEvaluationDetail.biz_impact.summary}</p>` : ''}
                        
                        ${aiEvaluationDetail.biz_impact?.key_benefits?.length > 0 ? `
                            <div class="key-benefits">
                                <strong>í•µì‹¬ ì´ì :</strong>
                                <ul>
                                    ${aiEvaluationDetail.biz_impact.key_benefits.map(benefit => 
                                        `<li>${benefit}</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${aiEvaluationDetail.biz_impact?.strategic_alignment ? `
                            <div class="strategic-box">
                                <strong>ì „ëµì  ì—°ê³„ì„±:</strong>
                                <p>${aiEvaluationDetail.biz_impact.strategic_alignment}</p>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Feasibility -->
                    <div class="ai-section">
                        <h4><i class="icon">âš™ï¸</i> 3. Feasibility (ì‹¤í˜„ ê°€ëŠ¥ì„±)</h4>
                        <div class="impact-score">
                            <div class="score-display">
                                <span class="score-number">${aiEvaluationDetail.feasibility?.score?.toFixed(1) || 'N/A'}</span>
                                <span class="score-max">/ 5.0</span>
                                <span class="badge badge-grade-${aiEvaluationDetail.scores?.['Feasibility']?.grade || 'B'}">
                                    ${aiEvaluationDetail.scores?.['Feasibility']?.grade || '-'}
                                </span>
                            </div>
                        </div>
                        ${aiEvaluationDetail.feasibility?.summary ? 
                            `<p class="summary-text">${aiEvaluationDetail.feasibility.summary}</p>` : ''}
                        
                        <div class="feasibility-details">
                            ${aiEvaluationDetail.feasibility?.technical_difficulty ? 
                                `<div class="detail-badge">
                                    <strong>ê¸°ìˆ  ë‚œì´ë„:</strong> ${aiEvaluationDetail.feasibility.technical_difficulty}
                                </div>` : ''}
                            ${aiEvaluationDetail.feasibility?.timeline_estimate ? 
                                `<div class="detail-badge">
                                    <strong>ì˜ˆìƒ ê¸°ê°„:</strong> ${aiEvaluationDetail.feasibility.timeline_estimate}
                                </div>` : ''}
                        </div>
                        
                        ${aiEvaluationDetail.feasibility?.data_availability ? 
                            `<p class="detail-text"><strong>ë°ì´í„° í™•ë³´:</strong> ${aiEvaluationDetail.feasibility.data_availability}</p>` : ''}
                        ${aiEvaluationDetail.feasibility?.team_capability ? 
                            `<p class="detail-text"><strong>íŒ€ ì—­ëŸ‰:</strong> ${aiEvaluationDetail.feasibility.team_capability}</p>` : ''}
                        
                        ${aiEvaluationDetail.feasibility?.risks?.length > 0 ? `
                            <div class="risk-box">
                                <strong>ìœ„í—˜ ìš”ì†Œ:</strong>
                                <ul>
                                    ${aiEvaluationDetail.feasibility.risks.map(risk => 
                                        `<li>${risk}</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- ì „ë°˜ì ì¸ AI ìš”ì•½ -->
                    <div class="ai-section overall-summary">
                        <h4><i class="icon">ğŸ“‹</i> 4. ì „ë°˜ì ì¸ AI ìš”ì•½</h4>
                        
                        <div class="recommendation-badge">
                            <strong>ì¶”ì²œë„:</strong>
                            <span class="badge badge-recommendation">${aiEvaluationDetail.overall_summary?.recommendation || 'N/A'}</span>
                            <span class="badge badge-grade-${app.ai_grade}">${app.ai_grade}</span>
                        </div>
                        
                        ${aiEvaluationDetail.overall_summary?.core_value ? 
                            `<div class="core-value-box">
                                <strong>í•µì‹¬ ê°€ì¹˜:</strong>
                                <p>${aiEvaluationDetail.overall_summary.core_value}</p>
                            </div>` : ''}
                        
                        ${aiEvaluationDetail.overall_summary?.review_points?.length > 0 ? `
                            <div class="review-points">
                                <strong>ì‹¬ì‚¬ ì‹œ ì£¼ëª©í•  í¬ì¸íŠ¸:</strong>
                                <ul>
                                    ${aiEvaluationDetail.overall_summary.review_points.map(point => 
                                        `<li>${point}</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${aiEvaluationDetail.overall_summary?.final_comment ? 
                            `<div class="final-comment">
                                <em>"${aiEvaluationDetail.overall_summary.final_comment}"</em>
                            </div>` : ''}
                    </div>
                ` : `
                    <p class="text-muted">ì•„ì§ AI í‰ê°€ê°€ ì§„í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                `}
            </div>
            
            <!-- ê³¼ì œ ë‚´ìš© -->
            <div class="card">
                <h3>ê³¼ì œ ë‚´ìš©</h3>
                <div class="detail-item">
                    <label>í˜„ì¬ ì—…ë¬´</label>
                    <div class="text-content">${app.current_work || '-'}</div>
                </div>
                <div class="detail-item">
                    <label>Pain Point</label>
                    <div class="text-content">${app.pain_point || '-'}</div>
                </div>
                <div class="detail-item">
                    <label>ê°œì„  ì•„ì´ë””ì–´</label>
                    <div class="text-content">${app.improvement_idea || '-'}</div>
                </div>
                <div class="detail-item">
                    <label>ê¸°ëŒ€ íš¨ê³¼</label>
                    <div class="text-content">${app.expected_effect || '-'}</div>
                </div>
                <div class="detail-item">
                    <label>ë°”ë¼ëŠ” ì </label>
                    <div class="text-content">${app.hope || '-'}</div>
                </div>
            </div>
            
            <!-- ê¸°ìˆ  ì—­ëŸ‰ -->
            ${Object.keys(techCapabilities).length > 0 ? `
            <div class="card">
                <h3>ê¸°ìˆ  ì—­ëŸ‰</h3>
                <div class="tech-capabilities">
                    ${Object.entries(techCapabilities).map(([key, value]) => `
                        <div class="tech-item">
                            <label>${key}</label>
                            <div>${value}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- ì‚¬ìš©ì í‰ê°€ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0;">ì‹¬ì‚¬ìœ„ì› í‰ê°€</h3>
                    ${(user.role === 'admin' || (app.department_id && user.department_id === app.department_id)) ? `
                        <button onclick="showEvaluationForm()" class="btn btn-primary">
                            ${currentUserEvaluation ? 'ë‚´ í‰ê°€ ìˆ˜ì •' : 'í‰ê°€í•˜ê¸°'}
                        </button>
                    ` : ''}
                </div>
                <div id="evaluations-list">
                    <p class="text-muted">í‰ê°€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
            
            <!-- í‰ê°€ í¼ (ìˆ¨ê¹€) -->
            <div id="evaluation-form" class="card" style="display: none;">
                <h3 id="evaluation-form-title">í‰ê°€ ì‘ì„±</h3>
                <form onsubmit="submitEvaluation(event)">
                    <div class="form-group">
                        <label for="grade">ë“±ê¸‰ *</label>
                        <select id="grade" name="grade" class="form-control" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="S">S - ìµœìš°ìˆ˜</option>
                            <option value="A">A - ìš°ìˆ˜</option>
                            <option value="B">B - ì–‘í˜¸</option>
                            <option value="C">C - ë³´í†µ</option>
                            <option value="D">D - ë¯¸í¡</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="comment">ì½”ë©˜íŠ¸ *</label>
                        <textarea id="comment" name="comment" class="form-control" rows="5" required></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">í‰ê°€ ì œì¶œ</button>
                        <button type="button" onclick="hideEvaluationForm()" class="btn btn-secondary">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        `;
        
        // HTML ë Œë”ë§ í›„ í‰ê°€ ëª©ë¡ ë¡œë“œ
        await loadEvaluations();
        
    } catch (error) {
        console.error('Error loading application:', error);
        container.innerHTML = `
            <div class="alert alert-danger">
                ì§€ì›ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>
        `;
    }
}

function getStatusText(status) {
    const statusMap = {
        'pending': 'ëŒ€ê¸°',
        'ai_evaluated': 'AI í‰ê°€ ì™„ë£Œ',
        'user_evaluated': 'ì‹¬ì‚¬ ì™„ë£Œ',
        'approved': 'ìŠ¹ì¸',
        'rejected': 'ë°˜ë ¤'
    };
    return statusMap[status] || status;
}

async function loadEvaluations() {
    try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(`/api/applications/${applicationId}/evaluations`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error('Failed to load evaluations');
        }
        
        allEvaluations = await response.json();
        
        // í˜„ì¬ ì‚¬ìš©ìì˜ í‰ê°€ ì°¾ê¸°
        currentUserEvaluation = allEvaluations.find(e => e.is_current_user);
        
        renderEvaluations();
    } catch (error) {
        console.error('Error loading evaluations:', error);
        document.getElementById('evaluations-list').innerHTML = 
            '<p class="text-danger">í‰ê°€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
    }
}

function renderEvaluations() {
    const container = document.getElementById('evaluations-list');
    
    if (allEvaluations.length === 0) {
        container.innerHTML = '<p class="text-muted">ì•„ì§ í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }
    
    let html = '<div class="evaluations-grid">';
    
    allEvaluations.forEach((evaluation, index) => {
        const isCurrentUser = evaluation.is_current_user;
        html += `
            <div class="evaluation-card ${isCurrentUser ? 'current-user-evaluation' : ''}">
                <div class="evaluation-header">
                    <div>
                        <span class="badge badge-grade-${evaluation.grade}">${evaluation.grade}</span>
                        <strong style="margin-left: 0.5rem;">${evaluation.evaluator_name}</strong>
                        ${isCurrentUser ? '<span class="badge badge-info" style="margin-left: 0.5rem;">ë‚´ í‰ê°€</span>' : ''}
                    </div>
                    <small class="text-muted">${new Date(evaluation.created_at).toLocaleString('ko-KR')}</small>
                </div>
                <div class="evaluation-content">
                    <p class="text-content">${evaluation.comment || '-'}</p>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    
    // í‰ê°€ í†µê³„ ì¶”ê°€ (ê´€ë¦¬ìë§Œ)
    if (user.role === 'admin' && allEvaluations.length > 1) {
        const gradeCount = {};
        allEvaluations.forEach(e => {
            gradeCount[e.grade] = (gradeCount[e.grade] || 0) + 1;
        });
        
        html += '<div class="evaluation-summary">';
        html += '<h4>í‰ê°€ ìš”ì•½</h4>';
        html += '<div class="grade-distribution">';
        Object.entries(gradeCount).sort().forEach(([grade, count]) => {
            html += `<span class="badge badge-grade-${grade}" style="margin-right: 0.5rem;">${grade}: ${count}ëª…</span>`;
        });
        html += '</div>';
        html += `<p class="text-muted" style="margin-top: 0.5rem;">ì´ ${allEvaluations.length}ëª…ì´ í‰ê°€í–ˆìŠµë‹ˆë‹¤.</p>`;
        html += '</div>';
    }
    
    container.innerHTML = html;
}

function showEvaluationForm() {
    const form = document.getElementById('evaluation-form');
    const title = document.getElementById('evaluation-form-title');
    
    // í˜„ì¬ ì‚¬ìš©ìì˜ í‰ê°€ê°€ ìˆìœ¼ë©´ í¼ì— ì±„ìš°ê¸°
    if (currentUserEvaluation) {
        title.textContent = 'ë‚´ í‰ê°€ ìˆ˜ì •';
        document.getElementById('grade').value = currentUserEvaluation.grade;
        document.getElementById('comment').value = currentUserEvaluation.comment || '';
    } else {
        title.textContent = 'í‰ê°€ ì‘ì„±';
        document.getElementById('grade').value = '';
        document.getElementById('comment').value = '';
    }
    
    form.style.display = 'block';
    form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function hideEvaluationForm() {
    document.getElementById('evaluation-form').style.display = 'none';
}

async function submitEvaluation(event) {
    event.preventDefault();
    
    const grade = document.getElementById('grade').value;
    const comment = document.getElementById('comment').value;
    
    if (!grade || !comment) {
        alert('ë“±ê¸‰ê³¼ ì½”ë©˜íŠ¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(`/api/applications/${applicationId}/evaluate`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ grade, comment })
        });
        
        if (response.ok) {
            const isUpdate = currentUserEvaluation !== null;
            alert(isUpdate ? 'í‰ê°€ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
            hideEvaluationForm();
            await loadEvaluations(); // í‰ê°€ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
        } else {
            const error = await response.json();
            alert(`í‰ê°€ ${currentUserEvaluation ? 'ìˆ˜ì •' : 'ì œì¶œ'} ì‹¤íŒ¨: ${error.detail}`);
        }
    } catch (error) {
        console.error('Error submitting evaluation:', error);
        alert('í‰ê°€ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

async function deleteApplication() {
    if (!confirm('ì •ë§ ì´ ì§€ì›ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(`/api/applications/${applicationId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            alert('ì§€ì›ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/applications';
        } else {
            const error = await response.json();
            alert(`ì‚­ì œ ì‹¤íŒ¨: ${error.detail}`);
        }
    } catch (error) {
        console.error('Error deleting application:', error);
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

const user = {
    id: {{ user.id }},
    username: "{{ user.username }}",
    name: "{{ user.name }}",
    role: "{{ user.role }}"
};

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
loadApplicationDetail();
</script>

<style>
.detail-container {
    max-width: 1200px;
    margin: 0 auto;
}

.card {
    background: white;
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 16px;
}

.detail-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.detail-item.full-width {
    grid-column: 1 / -1;
}

.detail-item label {
    font-weight: 600;
    color: #666;
    font-size: 14px;
}

.detail-item > div {
    font-size: 16px;
    color: #333;
}

.text-content {
    white-space: pre-wrap;
    line-height: 1.6;
    background: #f5f5f5;
    padding: 12px;
    border-radius: 4px;
}

.tech-capabilities {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.tech-item {
    padding: 12px;
    background: #f5f5f5;
    border-radius: 4px;
}

.tech-item label {
    font-size: 12px;
    color: #666;
    display: block;
    margin-bottom: 4px;
}

.evaluation-scores {
    margin-top: 20px;
}

.evaluation-scores h4 {
    margin-bottom: 12px;
}

.badge-grade-S { background: #10b981; color: white; }
.badge-grade-A { background: #3b82f6; color: white; }
.badge-grade-B { background: #f59e0b; color: white; }
.badge-grade-C { background: #ef4444; color: white; }
.badge-grade-D { background: #6b7280; color: white; }
.badge-grade-none { background: #e5e7eb; color: #6b7280; }

.loading {
    text-align: center;
    padding: 40px;
    color: #666;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #374151;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.text-content {
    white-space: pre-wrap;
    line-height: 1.6;
}

.evaluations-grid {
    display: grid;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.evaluation-card {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    background: #f9fafb;
}

.evaluation-card.current-user-evaluation {
    border-color: #667eea;
    background: #f0f4ff;
}

.evaluation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #e5e7eb;
}

.evaluation-content p {
    margin: 0;
    color: #374151;
}

.evaluation-summary {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
}

.evaluation-summary h4 {
    margin: 0 0 0.75rem 0;
    font-size: 1rem;
    color: #374151;
}

.grade-distribution {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.badge-info {
    background: #3b82f6;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
}

/* AI í‰ê°€ ê²°ê³¼ ìƒˆ ìŠ¤íƒ€ì¼ */
.ai-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
}

.ai-section:last-child {
    border-bottom: none;
}

.ai-section h4 {
    color: #374151;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ai-section .icon {
    font-size: 1.5rem;
}

.ai-tech-classification {
    background: #f0f9ff;
    border-left: 4px solid #3b82f6;
    padding: 1rem;
    border-radius: 4px;
}

.tech-badge-large {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.badge-tech {
    background: #3b82f6;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 600;
}

.reason-text {
    color: #1e40af;
    margin: 0.5rem 0 0 0;
    line-height: 1.6;
}

.impact-score {
    margin-bottom: 1rem;
}

.score-display {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.score-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #667eea;
}

.score-max {
    font-size: 1.2rem;
    color: #6b7280;
}

.summary-text {
    background: #f9fafb;
    padding: 1rem;
    border-radius: 6px;
    line-height: 1.6;
    color: #374151;
    margin: 0.75rem 0;
}

.key-benefits {
    background: #ecfdf5;
    border-left: 4px solid #10b981;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.key-benefits ul {
    margin: 0.5rem 0 0 0;
    padding-left: 1.5rem;
}

.key-benefits li {
    margin: 0.25rem 0;
    color: #065f46;
}

.strategic-box {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.strategic-box p {
    margin: 0.5rem 0 0 0;
    color: #92400e;
    line-height: 1.6;
}

.feasibility-details {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin: 1rem 0;
}

.detail-badge {
    background: #e0e7ff;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    color: #3730a3;
    font-size: 0.9rem;
}

.detail-text {
    color: #374151;
    margin: 0.5rem 0;
    line-height: 1.6;
}

.risk-box {
    background: #fee2e2;
    border-left: 4px solid #ef4444;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.risk-box ul {
    margin: 0.5rem 0 0 0;
    padding-left: 1.5rem;
}

.risk-box li {
    margin: 0.25rem 0;
    color: #991b1b;
}

.overall-summary {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
}

.recommendation-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding: 0.75rem;
    background: white;
    border-radius: 6px;
}

.badge-recommendation {
    background: #10b981;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
}

.core-value-box {
    background: white;
    border: 1px solid #e2e8f0;
    padding: 1rem;
    border-radius: 6px;
    margin: 1rem 0;
}

.core-value-box p {
    margin: 0.5rem 0 0 0;
    color: #1e293b;
    line-height: 1.8;
    font-size: 1.05rem;
}

.review-points {
    background: #fffbeb;
    border-left: 4px solid #f59e0b;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.review-points ul {
    margin: 0.5rem 0 0 0;
    padding-left: 1.5rem;
}

.review-points li {
    margin: 0.5rem 0;
    color: #78350f;
    font-weight: 500;
}

.final-comment {
    text-align: center;
    padding: 1rem;
    margin-top: 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    font-size: 1.1rem;
    font-style: italic;
}
</style>
{% endblock %}

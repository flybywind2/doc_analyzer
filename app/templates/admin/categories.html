{% extends "base.html" %}

{% block title %}ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ - AI ê³¼ì œ ì§€ì›ì„œ í‰ê°€ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-2xl font-bold text-gray-900">AI ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h2>
            <p class="text-gray-500 mt-1">AI ê¸°ìˆ  ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê³¼ì œë¥¼ ë¶„ë¥˜í•˜ê³  ë¹„êµ ë¶„ì„í•©ë‹ˆë‹¤.</p>
        </div>
        <button onclick="showCreateModal()" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
            <i class="fa-solid fa-plus mr-2"></i> ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
        </button>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200" id="categories-table">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">AI ì¹´í…Œê³ ë¦¬</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì§€ì›ì„œ ìˆ˜</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì„¤ëª…</th>
                        <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="categories-tbody" class="bg-white divide-y divide-gray-200">
                    <tr><td colspan="4" class="px-6 py-10 text-center text-gray-500"><i class="fa-solid fa-circle-notch fa-spin text-blue-500 mr-2"></i> ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ì§€ì›ì„œ ë¹„êµ ëª¨ë‹¬ -->
<div id="compare-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeCompareModal()"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="flex justify-between items-center mb-4 border-b pb-4">
                    <h2 class="text-xl font-bold text-gray-900" id="compare-modal-title">ì§€ì›ì„œ ë¹„êµ</h2>
                    <button onclick="closeCompareModal()" class="text-gray-400 hover:text-gray-500 focus:outline-none">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r-md compare-instructions">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fa-solid fa-circle-info text-blue-500"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">ìµœëŒ€ 5ê°œì˜ ì§€ì›ì„œë¥¼ ì„ íƒí•˜ì—¬ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì§€ì›ì„œ ì„ íƒ ì˜ì—­ -->
                    <div class="selection-area space-y-4">
                        <h3 class="text-lg font-medium text-gray-900 flex items-center">
                            ì§€ì›ì„œ ì„ íƒ <span id="selection-count" class="ml-2 text-blue-600 font-bold text-base">(0/5)</span>
                        </h3>
                        <div id="applications-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-1">
                            <div class="col-span-full text-center py-10 text-gray-500">
                                <i class="fa-solid fa-circle-notch fa-spin text-blue-500 mr-2"></i> ë¡œë”© ì¤‘...
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë¹„êµ ë²„íŠ¼ -->
                    <div class="compare-actions mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-100">
                        <button onclick="closeCompareModal()" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            ì·¨ì†Œ
                        </button>
                        <button id="compare-btn" onclick="showComparison()" disabled class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
                            ì„ íƒí•œ ì§€ì›ì„œ ë¹„êµí•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- ë¹„êµ ê²°ê³¼ ì˜ì—­ -->
                    <div id="comparison-result" class="hidden">
                        <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">ë¹„êµ ê²°ê³¼</h3>
                            <button onclick="resetComparison()" class="px-3 py-1.5 border border-gray-300 rounded-md text-xs font-medium text-gray-700 bg-white hover:bg-gray-50">
                                <i class="fa-solid fa-rotate-left mr-1"></i> ë‹¤ì‹œ ì„ íƒ
                            </button>
                        </div>
                        <div id="comparison-content" class="overflow-x-auto pb-4"></div>
                        
                        <div class="mt-6 flex justify-end space-x-3 pt-4 border-t border-gray-100 comparison-actions-bottom">
                            <button onclick="resetComparison()" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                                <i class="fa-solid fa-rotate-left mr-2"></i> ë‹¤ì‹œ ì„ íƒ
                            </button>
                            <button onclick="printComparison()" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <i class="fa-solid fa-print mr-2"></i> ì¸ì‡„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Modal -->
<div id="category-modal" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeModal()"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fa-solid fa-tag text-blue-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
                        <div class="mt-4">
                            <form id="category-form" onsubmit="handleSubmit(event)">
                                <input type="hidden" id="category-id">
                                <div class="mb-4">
                                    <label for="category-name" class="block text-sm font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬ëª… *</label>
                                    <input type="text" id="category-name" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border border-gray-300 rounded-md p-2" required>
                                </div>
                                <div class="mb-4">
                                    <label for="category-description" class="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                                    <textarea id="category-description" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border border-gray-300 rounded-md p-2"></textarea>
                                </div>
                                <div class="mb-4">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="category-active" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                                        <label for="category-active" class="ml-2 block text-sm text-gray-900">
                                            í™œì„±í™”
                                        </label>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" onclick="document.getElementById('category-form').dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}))" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    ì €ì¥
                </button>
                <button type="button" onclick="closeModal()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let categories = [];
let aiCategories = ['ì˜ˆì¸¡', 'ë¶„ë¥˜', 'ì±—ë´‡', 'ì—ì´ì „íŠ¸', 'ìµœì í™”', 'ê°•í™”í•™ìŠµ'];
let categoryApplications = {};
let selectedApplications = [];
let currentCategory = '';

async function loadCategories() {
    const tbody = document.getElementById('categories-tbody');
    tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-10 text-center text-gray-500"><i class="fa-solid fa-circle-notch fa-spin text-blue-500 mr-2"></i> ë¡œë”© ì¤‘...</td></tr>';
    
    try {
        // AI ì¹´í…Œê³ ë¦¬ë³„ ì§€ì›ì„œ ìˆ˜ ë¡œë“œ
        const response = await apiFetch('/api/applications');
        if (response.ok) {
            const applications = await response.json();
            
            // ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™”
            categoryApplications = {};
            aiCategories.forEach(cat => {
                categoryApplications[cat] = applications.filter(app => 
                    app.ai_category_primary === cat
                );
            });
            
            renderCategories();
        } else {
            showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        console.error('Error loading data:', error);
        showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
}

function renderCategories() {
    const tbody = document.getElementById('categories-tbody');
    tbody.innerHTML = '';

    aiCategories.forEach(category => {
        const apps = categoryApplications[category] || [];
        const row = `
            <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        ${category}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${apps.length}ê°œ</td>
                <td class="px-6 py-4 text-sm text-gray-500">${getCategoryDescription(category)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                    <button class="inline-flex items-center text-blue-600 hover:text-blue-900 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
                            onclick="openCompareModal('${category}')" 
                            ${apps.length < 2 ? 'disabled' : ''}>
                        <i class="fa-solid fa-scale-balanced mr-1.5"></i> ì§€ì›ì„œ ë¹„êµ
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function getCategoryDescription(category) {
    const descriptions = {
        'ì˜ˆì¸¡': 'ë¯¸ë˜ ê°’ ì˜ˆì¸¡, ìˆ˜ìš” ì˜ˆì¸¡, íŠ¸ë Œë“œ ë¶„ì„',
        'ë¶„ë¥˜': 'ì´ë¯¸ì§€/í…ìŠ¤íŠ¸ ë¶„ë¥˜, ë¶ˆëŸ‰ ê²€ì¶œ, ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜',
        'ì±—ë´‡': 'ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤, ìë™ ì‘ë‹µ, Q&A',
        'ì—ì´ì „íŠ¸': 'ììœ¨ ì˜ì‚¬ê²°ì •, ë³µì¡í•œ ì‘ì—… ìë™í™”',
        'ìµœì í™”': 'ìì› ìµœì í™”, ìŠ¤ì¼€ì¤„ë§, ê²½ë¡œ ìµœì í™”',
        'ê°•í™”í•™ìŠµ': 'í•™ìŠµ ê¸°ë°˜ ì˜ì‚¬ê²°ì •, ì‹œë®¬ë ˆì´ì…˜ ìµœì í™”'
    };
    return descriptions[category] || '';
}

function openCompareModal(category) {
    currentCategory = category;
    selectedApplications = [];
    document.getElementById('compare-modal-title').textContent = `${category} ì¹´í…Œê³ ë¦¬ ì§€ì›ì„œ ë¹„êµ`;
    document.getElementById('compare-modal').classList.remove('hidden');
    document.getElementById('comparison-result').classList.add('hidden');
    document.querySelector('.selection-area').classList.remove('hidden');
    document.querySelector('.compare-actions').classList.remove('hidden');
    document.querySelector('.compare-instructions').classList.remove('hidden');
    
    renderApplicationsList();
}

function closeCompareModal() {
    document.getElementById('compare-modal').classList.add('hidden');
    selectedApplications = [];
    currentCategory = '';
}

function renderApplicationsList() {
    const apps = categoryApplications[currentCategory] || [];
    const container = document.getElementById('applications-list');
    
    if (apps.length === 0) {
        container.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500">ì´ ì¹´í…Œê³ ë¦¬ì— ì§€ì›ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    
    container.innerHTML = apps.map(app => `
        <div class="relative rounded-lg border-2 p-4 cursor-pointer transition-all hover:shadow-md ${selectedApplications.includes(app.id) ? 'border-blue-500 bg-blue-50 ring-2 ring-blue-200' : 'border-gray-200 bg-white hover:border-blue-300'}" 
             onclick="toggleSelection(${app.id})">
            <div class="flex justify-between items-start mb-2">
                <div class="flex items-center h-5">
                    <input type="checkbox" ${selectedApplications.includes(app.id) ? 'checked' : ''} 
                           class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"
                           onclick="event.stopPropagation(); toggleSelection(${app.id})">
                </div>
                <span class="${getGradeBadgeClass(app.ai_grade || 'B')}">${app.ai_grade || 'N/A'}</span>
            </div>
            <h4 class="text-sm font-bold text-gray-900 mb-2 line-clamp-2 min-h-[2.5rem]">${app.subject}</h4>
            <div class="flex flex-col gap-1 text-xs text-gray-500 mb-2">
                <span class="flex items-center"><i class="fa-solid fa-building w-4 text-center mr-1"></i> ${app.division || 'N/A'}</span>
                <span class="flex items-center"><i class="fa-solid fa-users w-4 text-center mr-1"></i> ${app.participant_count || 0}ëª…</span>
            </div>
            <div class="text-xs text-gray-500 pt-2 border-t border-gray-100 line-clamp-2">
                ${app.pain_point ? app.pain_point : 'Pain Point ì—†ìŒ'}
            </div>
        </div>
    `).join('');
    
    updateSelectionCount();
}

function getGradeBadgeClass(grade) {
    const baseClasses = "inline-flex items-center px-2 py-0.5 rounded text-xs font-medium";
    if (grade === 'S' || grade >= 90) return `${baseClasses} bg-purple-100 text-purple-800`;
    if (grade === 'A' || grade >= 80) return `${baseClasses} bg-green-100 text-green-800`;
    if (grade === 'B' || grade >= 70) return `${baseClasses} bg-blue-100 text-blue-800`;
    if (grade === 'C' || grade >= 60) return `${baseClasses} bg-yellow-100 text-yellow-800`;
    return `${baseClasses} bg-gray-100 text-gray-800`;
}

function toggleSelection(appId) {
    const index = selectedApplications.indexOf(appId);
    
    if (index > -1) {
        selectedApplications.splice(index, 1);
    } else {
        if (selectedApplications.length >= 5) {
            alert('ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        selectedApplications.push(appId);
    }
    
    renderApplicationsList();
}

function updateSelectionCount() {
    document.getElementById('selection-count').textContent = `(${selectedApplications.length}/5)`;
    document.getElementById('compare-btn').disabled = selectedApplications.length < 2;
}

async function showComparison() {
    if (selectedApplications.length < 2) {
        alert('ìµœì†Œ 2ê°œì˜ ì§€ì›ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì„ íƒëœ ì§€ì›ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const apps = categoryApplications[currentCategory].filter(app => 
        selectedApplications.includes(app.id)
    );
    
    // ë¹„êµ ê²°ê³¼ í‘œì‹œ
    document.querySelector('.selection-area').classList.add('hidden');
    document.querySelector('.compare-actions').classList.add('hidden');
    document.querySelector('.compare-instructions').classList.add('hidden');
    document.getElementById('comparison-result').classList.remove('hidden');
    
    renderComparison(apps);
}

function renderComparison(apps) {
    const container = document.getElementById('comparison-content');
    
    let html = `
        <table class="min-w-full border-collapse text-sm">
            <thead>
                <tr>
                    <th class="p-4 text-left bg-gray-50 border border-gray-200 sticky left-0 z-10 font-bold text-gray-700 min-w-[150px]">ë¹„êµ í•­ëª©</th>
                    ${apps.map((app, idx) => `
                        <th class="p-4 text-left bg-gray-50 border border-gray-200 font-bold text-gray-700 min-w-[200px]">ì§€ì›ì„œ ${idx + 1}</th>
                    `).join('')}
                </tr>
            </thead>
            <tbody>
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <tr>
                    <td class="p-3 bg-blue-600 text-white font-bold border border-blue-700 sticky left-0 z-10" colspan="${apps.length + 1}">ğŸ“‹ ê¸°ë³¸ ì •ë³´</td>
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">ê³¼ì œëª…</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white font-bold text-gray-900">${app.subject}</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">ì‚¬ì—…ë¶€</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700">${app.division || '-'}</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">ë¶€ì„œ</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700">${app.department_name || '-'}</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">ì°¸ì—¬ ì¸ì›</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700">${app.participant_count || 0}ëª…</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">AI ë“±ê¸‰</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white"><span class="${getGradeBadgeClass(app.ai_grade || 'B')}">${app.ai_grade || 'N/A'}</span></td>`).join('')}
                </tr>
                
                <!-- ë¬¸ì œ ë° í•´ê²°ë°©ì•ˆ -->
                <tr>
                    <td class="p-3 bg-blue-600 text-white font-bold border border-blue-700 sticky left-0 z-10" colspan="${apps.length + 1}">ğŸ¯ ë¬¸ì œ ë° í•´ê²°ë°©ì•ˆ</td>
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10 align-top">Pain Point</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700 align-top min-w-[250px] leading-relaxed">${app.pain_point || '-'}</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10 align-top">ê°œì„  ì•„ì´ë””ì–´</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700 align-top min-w-[250px] leading-relaxed">${app.improvement_idea || '-'}</td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10 align-top">ê¸°ëŒ€ íš¨ê³¼</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white text-gray-700 align-top min-w-[250px] leading-relaxed">${app.expected_effect || '-'}</td>`).join('')}
                </tr>
                
                <!-- AI ìš”ì•½ -->
                <tr>
                    <td class="p-3 bg-blue-600 text-white font-bold border border-blue-700 sticky left-0 z-10" colspan="${apps.length + 1}">ğŸ¤– AI ìš”ì•½</td>
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10">AI ê¸°ìˆ  ë¶„ë¥˜</td>
                    ${apps.map(app => `<td class="p-3 border border-gray-200 bg-white"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${app.ai_category_primary || 'ë¶„ë¥˜'}</span></td>`).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10 align-top">ê²½ì˜íš¨ê³¼</td>
                    ${apps.map(app => {
                        const detail = app.ai_evaluation_detail || {};
                        return `<td class="p-3 border border-gray-200 bg-white text-gray-700 align-top min-w-[250px] leading-relaxed">${detail.business_impact || '-'}</td>`;
                    }).join('')}
                </tr>
                <tr>
                    <td class="p-3 bg-gray-50 font-semibold border border-gray-200 sticky left-0 z-10 align-top">êµ¬í˜„ ê°€ëŠ¥ì„±</td>
                    ${apps.map(app => {
                        const detail = app.ai_evaluation_detail || {};
                        return `<td class="p-3 border border-gray-200 bg-white text-gray-700 align-top min-w-[250px] leading-relaxed">${detail.technical_feasibility || '-'}</td>`;
                    }).join('')}
                </tr>
            </tbody>
        </table>
    `;
    
    container.innerHTML = html;
}

function resetComparison() {
    selectedApplications = [];
    document.querySelector('.selection-area').classList.remove('hidden');
    document.querySelector('.compare-actions').classList.remove('hidden');
    document.querySelector('.compare-instructions').classList.remove('hidden');
    document.getElementById('comparison-result').classList.add('hidden');
    renderApplicationsList();
}

function printComparison() {
    window.print();
}

function showCreateModal() {
    document.getElementById('category-modal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('category-modal').classList.add('hidden');
}

// Load categories on page load
document.addEventListener('DOMContentLoaded', () => {
    loadCategories();
});
</script>

<style>
/* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
@media print {
    /* base.htmlì˜ nav, sidebar ë“±ì„ ìˆ¨ê²¨ì•¼ í•¨. Tailwindì—ì„œëŠ” hidden í´ë˜ìŠ¤ ì‚¬ìš© */
    nav, .page-header, .comparison-actions-bottom, .compare-actions, footer {
        display: none !important;
    }
    
    /* ëª¨ë‹¬ ë°°ê²½ê³¼ ìœ„ì¹˜ ì¡°ì • */
    #compare-modal {
        position: static !important;
        background: white !important;
        display: block !important;
        overflow: visible !important;
    }
    
    /* ëª¨ë‹¬ ë‚´ë¶€ ì»¨í…ì¸  í™•ì¥ */
    .inline-block {
        display: block !important;
        width: 100% !important;
        max-width: 100% !important;
        box-shadow: none !important;
        margin: 0 !important;
        transform: none !important;
    }
    
    /* ìŠ¤í¬ë¡¤ ì œê±° */
    .overflow-x-auto, .overflow-y-auto {
        overflow: visible !important;
    }
    
    /* í°íŠ¸ í¬ê¸° ì¡°ì • */
    body {
        font-size: 10pt;
    }
    
    /* ë¶ˆí•„ìš”í•œ ìš”ì†Œ ìˆ¨ê¹€ */
    .close-btn, .modal-header button {
        display: none !important;
    }
    
    .bg-gray-50 {
        background-color: #f9fafb !important;
        -webkit-print-color-adjust: exact;
    }
    
    .bg-blue-600 {
        background-color: #2563eb !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
    }
}
</style>
{% endblock %}
